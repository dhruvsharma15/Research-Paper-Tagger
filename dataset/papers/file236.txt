Dans cet article, nous proposons une méthode permettant de tirer parti de toute information spatiale préalablement obtenue sur une image pour obtenir une segmentation hiérarchique de cette image qui met en exergue ses régions d'intérêt. Ceci nous permet d'avoir plus de détails dans ces régions tout en conser- vant les informations structurelles fortes de l'image.Les potentielles applications sont nombreuses. Cela permet- trait par exemple, lorsqu'on a une capacité de stockage limitée (e.g. pour de très larges images), de conserver les détails de l'image dans les régions d'intérêt en priorité. De nombreux casétantcas´casétant abordés dans un article associé [5], nous illustrerons dans la suite cette méthode uniquement par son applicationàapplication`applicationà unprobì eme de segmentation faiblement supervisé. Une vue d'ensemble est proposée en figure 1.Il a ´ eté montré que la segmentation est de façon inhérente unprobì eme multi-´ echelles. C'est pourquoi la segmentation hiérarchique est devenue une tendance majeure cesdernì eres années, et qu'elle a donné la plupart des algorithmes de l'´ etat de l'art actuel en segmentation. L'idée est de pas renvoyer uni- quement une partition des pixels de l'image mais une structure multi-´ echelles qui rende compte des objets d'intérêtintérêt`intérêtà toutes leséchelles les´leséchelles. Nous présentons ici un algorithme de segmentation hiérarchique qui se concentre sur certaines zones prédéterminées de l'image. L'aspect hiérarchique permet alors de choisir de façon simple le niveau de détails désiré en fonction de l'appli- cation. De plus, cet algorithme est très versatile car l'informa- tion spatiale a priori qu'il prend en entrée peutêtrepeutˆpeutêtre obtenu par n'importe laquelle des nombreuses approches de vision par or- dinateur existantes pour localiser les objets. De ce point de   Dans la section 2, nous expliquerons comment construire et utiliser un algorithme de segmentation hiérarchique sur graphes. Puis nous préciserons dans la section 3 comment utiliser une information spatiale a priori sur un objet d'intérêt pour obtenir une hiérarchiè a finesse régionalisée. Enfin, un exemple d'ap- plicationàplication`plicationà la segmentation faiblement supervisée sera présenté dans la partie 4 et des conclusions seront tirées dans la partie 5. On suppose que, pour chaque image, une partition fine est obtenue par une segmentation initiale et qu'elle contient tous les contours qui font sens dans l'image. On définit alors une mesure de dissimilarité entre tuiles adjacentes de cette partition fine. On peut alors voir l'image comme un graphe, le graphe d'adjacence de régions (GAR), dans lequel chaque noeud repré- sente une tuile de la partition fine ; une arête relie deux noeuds si les régions correspondantes sont voisines dans la partition fine ; le poids de chaque arête estégaìest´estégaì a la dissimilarité entre ces régions. Travailler sur le GAR est beaucoup plus efficient que de travailler sur l'image, car il y a beaucoup moins de noeuds dans le GAR qu'il n'y a de pixels dans l'image.De façon formelle, on note ce graphe G = (V, E, W), o` u V correspond au domaine de l'image où a l'ensemble des pixels ou régions fines, E ⊂ V × V est l'ensemble des arêtes reliant les régions voisines, W : E → R + est la valeur de dissimilarité généralement basée sur une mesure du gradient local (ou cou- leur ou texture), par exempleL'arête reliant les noeuds p et q est notée e pq . Un chemin est une suite de noeuds et d'arêtes : par exemple, un chemin liant les noeuds p et q est l'ensemble {p, e pt , t, e ts , s}. Un graphe connecté est un sous-graphe dans lequel toute paire de noeuds est connectée par un chemin. Un cycle est un chemin dont les extremités co¨ıncidentco¨ıncident. Un arbre est un graphe connecté sans cycle. Un arbre couvrant est un arbre contenant tous les noeuds. Un arbre de poids minimum (APM) APM(G) d'un graphe G est un arbre couvrant avec le poids minimal possible, obtenu par exemple en utilisant l'algorithme de Boruvka (le poids d'un arbré etantégaìetant´etantégaì a la somme des poids de ses arêtes). Une forêt est un ensemble d'arbres.Une partition π d'un ensemble V est une collection de sous- ensembles de V, tels que l'ensemble V soit l'union disjointe des sous-ensembles dans la partition, i.e.a une partition du graphe. La partition obte- nue est alors la même que celle qui auraitétéaurait´auraitété obtenue en cou- pant les arêtes de valuations supérieuressupérieures`supérieuresà λ directement dans G. Puisque travailler sur un APM(G) est moins coûteux et fournit des résultats similaires pour la segmentation, nous tra- vaillons dans la suite uniquement avec un APM(G).Couper les arêtes par valuation décroissante m` ene doncàdonc`doncà une hiérarchie de partitions indexée (H, λ), avec H une hiérarchie de partitions i.e. une chaine de partitions imbriquées. Cette application croissante nous permet d'attribueràattribuer`attribuerà chaque tronçon de contour le niveau de la hiérarchie pour le- quel il disparaˆıtdisparaˆıt : c'est la saillance du contour et on considère que plus la saillance est grande, plus le contour est fort. Pour une hiérarchie donnée, l'image dans laquelle chaque contour prend comme valeur sa saillance est appelée Carte de Contours Ultramétriques (CCU) [2]. Représenter une hiérarchie par sa CCU est une façon simple d'avoir une idée de son effet car seuiller une CCU aboutit toujoursàtoujours`toujoursà un ensemble de courbes fermées et doncàdonc`doncà une partition. Dans cet article, pour une mei- lleure visibilité, nous représentons les CCU avec un contraste inversé. Il y a plusieurs façons d'obtenir une segmentationàsegmentation`segmentationà partir d'une hiérarchie : (i) de façon simple en seuillant les saillances les plus hautes ; (ii) en marquant certains noeuds comme im- portants et en calculant alors une partition conformémentconformément`conformémentà ces marqueurs, connu sous le nom de segmentation avec mar- queurs ; (iii) en recherchant la segmentation minimisant une fonctionnellé energétique définie sur le graphe. Or, la qualité des segmentations obtenues dépend grande- ment de la dissimilarité que nous utilisons, et en changer peut meneràmener`menerà des segmentations plus pertinentes. La ligne de par- tage des eaux stochastique est un des outils possibles nous per- mettant d'attribuer aux contours des poids prenant en compte une information plus riche qu'une simple dissimilarité locale, de telle sorte que des méthodes plus simples soient suffisantes pour en extraire des segmentations intéressantes.Stochastique (LPES)La ligne de partage des eaux stochastique (LPES), introduite dans [1] par simulation etétenduèet´etétenduè a une approche par graphes dans [6], est un outil versatile pour construire des hiérarchies. L'idée originale est d'opéreropérer`opérerà de multiples reprises une seg- mentation avec marqueurs avec des marqueurs aléatoires puis de valuer chaque arête de l'APM par sa fréquence d'appari- tion dans les segmentations résultantes.En effet, en distribuant des marqueurs sur le GAR G, on peut construire une segmentation comme une FPM F(G) dans la- quelle chaque arbre prend racine dans un noeud marqué. On constate que la segmentation avec marqueurs est possible di- rectement sur l'APM : on doit alors couper, pour chaque paire de marqueurs, l'arête la plus haute sur le chemin les reliant. De plus, il y a un domaine de variation dans lequel chaque mar- queur peut se déplacer tout en aboutissantàaboutissant`aboutissantà la même segmen- tation. Plus de détails sont fournis dans l'article associé [5].Considérons sur l'APM une arête e st de poids ω st et cal- culons sa probabilité d'ˆ etre coupée. Nous coupons toutes les arêtes de l'APM ayant un poids supérieur oú egaì a ω st , ce qui aboutitàaboutit`aboutità deux arbres T s et T t de racines s et t. Si au moins un marqueur tombe dans le domaine R s des noeuds de T s et au moins un marqueur tombe dans le domaine R t des noeuds de T t , alors e st sera coupé dans la segmentation finale.Si l'on note µ(R) le nombre de marqueurs aléatoires tom- bant dans la région R, nous voulons attribueràattribuer`attribuerà e st la valeur de probabilité suivante :Si les marqueurs sont distribués suivant une distribution de Pois- son, alors pour une région R :avec Λ(R) l'espérance du nombre de marqueurs tombant dans R. La probabilité devient donc :Avec, lorsque la distribution de Poisson a une densité uni- forme λ :Et lorsque la distribution de Poisson a une densité non-uniforme λ :  La sortie de l'algorithme de LPES dépend donc de l'APM de départ (structure et valuations des arêtes) et de la loi de pro- babilité gouvernant la distribution des marqueurs. De plus, les hiérarchies de LPES peuventêtrepeuventˆpeuventêtre chaˆınéeschaˆınées puisque les nou- velles valuations des contours correspondentàcorrespondent`correspondentà des nouvelles valeurs pour l'APM et que l'on peut alors réitérer le proces- sus décrit précedemment sur cet APM. Ceci amène un large espace d'exploration qui peutêtrepeutˆpeutêtre utilisé dans une chaˆınechaˆıne de segmentation [4].Du fait de sa versatilité et de ses bonnes performances, la LPES représente un bon algorithme de départdépart`départà modifier pour y injecter une information spatiale a priori. En effet, lorsque l'on a une telle information sur l'image, est-il possible de l'uti- liser pour avoir plus de détails dans certaines parties de l'image plutôt que dans d'autres ? Cela permettrait de simplifier et d'amé- liorer des traitements ultérieurs en concentrant les efforts dans les zones d'intérêt. d'intérêt. Si on considère une région R de l'image, le nombre moyen de marqueurs tombant dans R est alors :De plus, cette approche peut aisémentaisémentˆaisémentêtré etendue au cas o` u l'on veut tirer parti d'informations provenant de sources mul- tiples. En effet, si θ E1 et θ E2 sont des densités de probabilités associées auxévènementsaux´auxévènements E 1 et E 2 , on peut combiner ces deux sources en utilisant comme nouvelle densité (θ E1 + θ E2 )λ. Dans la LPES originale, une distribution uniforme de mar- queurs est utilisée (quelque soit leur taille ou leur forme). Pour avoir des contours plus forts dans une région spécifique de l'image, on propose d'adapter le modèle pour que plus de mar- queurs soient distribués dans cette région.Soit E un objet d'une classe d'intérêt, par exemple E = "vélo", et I l'imagé etudiée. On note θ E la densité de probabi- lités associéè a E, définie sur le domaine D de I et obtenue par ailleurs. On note CP(I, θ E ) la carte de probabilités associée, dans laquelle chaque pixel p(x, y) de I prend comme valeur θ E (x, y) sa probabilité de faire partie de E. Etant donnée une telle information sur la position d'un objet d'intérêt dans une image, on obtient une hiérarchie de segmentations focalisée sur cette région en modulant la distribution des marqueurs.Si λ est une densité (uniforme ou non) définie sur D pour distribuer des marqueurs, on choisit θ E λ comme nouvelle den- sité, favorisant ainsi l'´ emergence de contours parmi les régions Si on veut favoriser l'´ emergence de certains contours, on peut moduler la densité de marqueurs dans chaque région en prenant en compte la force des contours les séparant mais aussi leur position relative dans chacune de ces régions.Par exemple, pour tester la force du gradient séparant les deux régions R s et R t , on peut localement distribuer des mar- queurs suivant une distribution χ(R s , R t )λ, avec χ(R s , R t ) = ω st . Cela correspond au cas classique de la LPES volumique, qui permet d'obtenir une hiérarchie prenant en comptè a la fois les surfaces des régions et les contrastes entre elles.On peut utiliser toute information spatiale a priori de façon similaire. En effet, en l'utilisant pour influencer la sortie de l'algorithme de segmentation, on peut vouloir choisir l'infor- mation pertinentè a mettre en valeur dans les segmentations résultantes : le premier-plan, larrì ere-plan ou les zones de tran- sition entre les deux.Par exemple, avoir plus de détails dans les régions de transi- tion entre le premier-plan et larrì ere-plan nous permet d'avoir plus de précisions l` a o` u la limite entre les deux est justement floue. Considérons ce cas. On définit pour chaque couple de régions (R s , R t ) un χ(R s , R t ) pertinent. On veut alors que χ(R s , R t ) soit petit si R s et R t sont au premier-plan où a larrì ere- plan, et grand si R s estàest`està larrì ere-plan et R t au premier plan (et vice-versa). On utilise : de segmentations focalisée sur cesélémentsces´ceséléments, i.e. une hiérarchie o` u les contours appartenantàappartenant`appartenantà cesélémentsces´ceséléments sont mis en exergue. Des résultats visuels sont présentés dans les figures 2, 3 et 4. 5 Conclusion m(R) (resp. σ(R)) ´ etant la moyenne normalisée (resp. l'´ ecart- type normalisé) des valeurs des pixels dans la région R de CP(I). Ainsi le nombre de marqueurs distribués sera plus grand lorsque le contraste entre les régions adjacentes sera grand (terme au numérateur) et lorsque ces régions seront cohérentes (terme au dénominateur).Dans cet article, nous avons proposé un algorithme novateur et efficient de segmentation hiérarchique mettant l'accent sur des régions d'intérêt d'une image en utilisant une information exogène obtenue sur celle-ci. La grande variété de possibles sources d'information exogène rend notre méthode extrêmement versatile, et nous l'avons ici illustrée sur leprobì eme de seg- mentation hiérarchique faiblement supervisé. Pour aller plus loin, on pourrait chercheràétendrechercher`chercheràchercherà´chercheràétendre ce travaiì a des vidéos.Il existe aujourd'hui de nombreux algorithmes permettant d'obtenir d'obtenir une localisationgrossì ere de l'objet princi- pal dans une image. On s'inspire de celle décrite dans [7] pour ce faire. En utilisant le classifieur de type réseau de neurones convolutifs (CNN) VGG19 [8] entraˆınéentraˆıné sur la base ImageNet [3], on commence par déterminer quelle est la classe principale dans l'image. Ce CNN prend comme entrée uniquement des images de taille 224 × 224 pixels. Une fois la classe de l'image déterminée, on peut alors, en changeant l'´ echelle de l'image d'un facteur s ∈ {0.5, 0.7, 1.0, 1.4, 2.0, 2.8}, calculer pour des sous-fenêtres de taille 224×224 de l'image, la probabilité d'ap- parition de la classe principale. On obtient ainsi une carte de probabilités de la classe principale pour chaqué echelle. Par max-pooling ("mise en commun en prenant le max"), on garde en mémoire le résultat de l'´ echelle pour laquelle la probabi- lité est la plus grande. La heatmap ("carte de chaleur") ainsi générée prend en chaque pixel pour valeur la probabilité que ce pixel appartiennè a la classe d'intérêt. Elle peut alorsêtrealorsˆalorsêtre uti- lisée en entrée de notre algorithme. De cette façon, nous avonsà avons`avonsà notre disposition un outil pour se focaliser automatiquement sur la classe principale de chaque scène.Au final, la combinaison de cette méthode et de la HFR est très intéressante puisqu'elle permet toutàtout`toutà la fois de classifier l'image (i.e. d'en déterminer la classe principale), d'y localiser lesélémentsles´leséléments de la classe principale et d'obtenir une hiérarchie
