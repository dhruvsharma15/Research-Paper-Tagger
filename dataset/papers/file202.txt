Trans-catheter arterial chemoembolization (TACE) [LGLS11] is a minimally invasive treatment for liver cancer, utilizing image guid- ance. Vessels which supply the hepatocellular carcinoma (HCC) with oxygenated blood are induced with chemotherapeutic agent and subsequently occluded by a physician [KCL * 05]. During the intervention, several 2-D projection images are acquired by a cone- beam C-arm CT scanner in order to reconstruct a volumetric Dyn- aCT image of the patient's abdomen. A segmentation of the cancer- ous tissue is performed on the image data. Subsequently, the outline of the segmented tumor is used to find collateral vessels.The more accurate the segmentation, the less healthy tissue sur- rounding the lesion is occluded, minimizing the toxicity of the pro- cedure. In addition, a higher percentage of the tumor can be treated with chemotherapeutic agent, increasing the efficacy of the ther- apy [LNT * 02]. Segmenting the tumor with high accuracy is espe- Figure 1: Challenges of hepatic lesion segmentation are (a) high diversity in gray-values, no typical shape, (b) intensity overlaps be- tween tumor and surrounding tissue, (c) intensity patches due to necrotic regions, and (d-f) varying appearance of the same tumor between 2-D slices.cially challenging due to variations in shape, size ( Fig. 1 a-f), and a high diversity in X-ray attenuation ( Fig. 1 a), as depicted in Fig. 1.Current approaches for intra-procedural tumor segmentation can be divided into three main categories depending on the involve- ment of the operating user in the segmentation process: manual, automatic, and interactive. (1) With manual segmentation schemes, users draw the complete contour line of the object to be segmented with minimal assistance by the system. A perfect manual segmen- tation of hepatic lesions is feasible, but would take several minutes until an appropriate result is reached during the intervention due to the primitive tools provided to the user. (2) Fully automated seg- mentation approaches may also exhibit long runtimes attributable to a lack of domain knowledge of the system. If learning-based, such methods may also need a large amount of training data in or- der to achieve an acceptable accuracy of their outcome. Still, a per- fect segmentation may not be reachable. Users do not have control over the process. However, trained physicians could substantially assist in reaching the goal of a fast and exact segmentation, due to their knowledge of a very good estimate of the true tumor extent. (3) Interactive segmentation methods are applicable, particularly in situations where only few or even no annotated data sets of similar segmentation tasks are available, or the task is to produce only a few new, but accurate segmentations. The limiting factor for scal- ing this approach is the time spent by users to provide input dur- ing each image segmentation task. Therefore, interactive methods are not a replacement for fully automated approaches, but can su- persede them in certain niches on account of their high accuracy reached by efficient use of their operators' expertise.of the segmentation computation, forming hierarchies of learned features. In this paper, we utilize the FCN topology for pixel level classification, that is commonly referred to as the U-net [RFB15]. In CNNs, pooling is performed to introduce a hierarchy of fea- tures, preserving only a condensed version of the former neighbor- hood's information. Some localization information is lost during each pooling operation due to an increasingly coarser image rep- resentation. The U-net architecture recovers spatial information by preserving spatial resolution from previous layers and linking it to later neurons in less fine-grained layers. The U-net architecture in combination with augmentation of the input image data [SSP03] allows for particularly high accuracy segmentation results from a relatively small set of training data.According to [OS01], user interactions can be categorized depend- ing on the interactive segmentation system's interface: (1) A menu- driven user input scheme as in [RPN15] limits the user's scope of action, trading their control over the segmentation outcome for more guidance by the system. (2) Setting parameter values directly demands an insight of the user into the algorithm. (3) Pictorial in- put on the image I ∈ R D1, D2, D3 , is the most intuitive case for the user.is the number of elements in the image. This method mimics human behavior during knowledge transfer via a visual medium. For the scope of this paper, a pictorial user input is utilized. This is the most challenging class of user simulation, but also the most intuitive interaction scheme for the human operator.FCNs have been successfully applied to several segmentation tasks [LSD15, RFB15], but were so far only considered in a fully automated context, consequently, omitting valuable prior knowl- edge of trained personnel. In this paper, we extend the use of FCNs by an interactive component during training. The resulting fully trained network is then able to improve its segmentation sugges- tions depending on user-defined seed points during the segmen- tation process. This property is achieved by simulating plausible user inputs during the training phase of the artificial neural network (ANN) by an active user model which reacts to segmentation sug- gestions. The interactive learning-based system is evaluated w. r. t. the well-known U-net [RFB15] without a user model and GrowCut [VK05, AGSM16] segmentation methods via the Sørensen-Dice coefficient (Dice) [Dic45].According to Nickisch et al. [NRKR10], there are three different approaches to include this user-dependent pictorial data into the evaluation process. Given a predefined task, several human partic- ipants interact with the system in (1) user studies or by (2) crowd sourcing in order to gather plausible hints at every step of the itera- tive segmentation. (3) An active user model (also called robot user) aims at a fast and highly scalable method to simulate plausible user interactions with the segmentation system. Such a model may be learned from a sufficiently large user interaction database compiled utilizing data from (1) or (2). Alternatively, the model can be de- fined by a rule-based system such as [NRKR10, ZND * 11] or the one proposed here.Pictorial scribbles (seed points, lines, and shapes) are drawn by the user as an overlay mask M on the visualization of the image I to segment. Lines and complex shapes are represented as a set of seed points. A seed point denotes a tupleis a position in the image space and l i ∈ {background, foreground} represents the label at this position in a binary segmentation system. Seed points are defined by the user in order to act as a representative subset S of the segmentation ground truth G := {s 0 , . . . , s N−1 }, S ⊆ G. The image with same dimensions as I and values l i at im- age coordinates p i , where tuple (p i , l i ) ∈ S, is called the seed mask M S . In each iteration, active user models add labeled scribbles to S based on the difference of the current segmentation to the ground truth in order to define the next interaction with the system, a strat- egy human users pursue as well.Upconvolutional network topologies such as the FCN are a promis- ing technique for solving element-wise (dense) prediction prob- lems on image data [LSD15, LBH15, WGCM16]. Classical convo- lutional neural networks (CNNs) typically append fully-connected layers or multilayer perceptrons to their contracting path. In con- trast, FCNs solely consist of convolutional and pooling layers. The missing layer types are substituted by unpooling/upsampling and deconvolutional/upconvolutional layers in an expanding path. Shift-invariant filter operations are therefore applied in each stepWe propose a rule-based user model as a surrogate operator of the interactive segmentation system during training. The user model simulates a human user during the training phase of the neural net- work by altering the input of the network for each epoch t. User input is considered additive.For the initial interaction S . This method prevents initial seed placement near the true contour line and mimics a quickly drawn rough estimate of the object to segment, as shown in Fig. 2 (a), where the outline of S do not contain any tumor object information are discarded to pre- serve a more balanced label distribution over all input slices. The data is divided (per patient and volumetric image) into 6, 375 2- D images for training, 1, 875 for validation, and 1, 800 images for testing (10, 050 in total).is depicted.At iterations t &gt; 0, the active user model takes the current binary segmentation B t := {s t t 0 , . . . , s N−1 } and ground truth G as input, as depicted in Fig. 2 (b). The user model extracts the setWe decided on a network depth of 4, 32 initial filters of size 3 × 3, a batch size of 10, and 30 epochs for training without early-stopping. The learning rate of 10 −4 and momentum 0.9 are set after train- assignments. It selects a subset ∅ = U t n ⊆ E t ; |U t n | = t | · n where 0 &lt; n &lt; 1, uniformly at random (Fig. 2 (c)). Subsequently, these seed points are added to the current seeds S t to create S t+1 := S t ∪ U t n . Fig. 2 (d) depicts a choice of seeds S 1 , which is utilized to generate an improved segmentation B 1 in Fig. 2 (e). As shown in Fig. 3 (right), the proposed neural network uses the gray- valued image data as input as well as user information in form of the seed mask M S t for each input image. I and M S t are incorpo- rated into the system as two separate input channels as depicted in Fig. 4.The data set used in this paper consists of 27 volumetric images. They correspond to reconstructions of DYNA-CT acquisitions of human patients' abdomina, with voxel resolutions from 0.46 3 mm 3 to 0.68 3 mm 3 . The hepatic lesions are fully annotated by two med- ical experts and can be fully embedded in manually selected cubic volumes of 100 3 voxels. This defines the fixed output size of the FCN. For the input volumes of interest (VOI), the dimensions of the output images have to be increased, to compensate the reduc- tion of input image dimensions in each consecutive hidden layer, due to the border handling during individual convolution opera- tions. Since the lesions are not on the border of the abdominal im- age volume, these cubic volumes can be padded with 92 voxels of surrounding gray-valued image data to VOIs of 284 3 voxels. Due to the small amount of fully annotated data sets available and to reduce the time of the learning process as well as the number of trainable weights of the system, we use 2-D slices of the 3-D vol- umes as input for the FCN. Therefore, parts of the spatial context information is neglected by the current system. The VOI cubes are sliced in transverse, coronal, and sagittal orientations. Planes which ing several FCNs on the same data set and varying parameters by an evaluation of their accuracy progression per epoch w. r. t. smoothness, overall slope and position of the minimal validation loss value. Data augmentation via elastic deformations [SSP03] is used to increase the amount of training and validation data by a factor of four as an additional regularizer, counteracting the risk of over-fitting during training. A standard deviation σ = 4 of the Gaus- sian in pixels and scaling factor α = 68 to control the deformations' intensity are chosen. The active user model's fraction of new input data to sample is set to n = 5 %, a reasonable value to simulate a hu- man user. Users will not place seeds in all erroneously segmented areas of the image (manual segmentation), but rather sparsely add more seed points. Several variants are tested in order to observe the networks behavior given more domain knowledge via the user input channel. The values for a user input mask are set to −1 for background, 0 for undecided, and 1 for foreground. Due to the same distance to the 0 value, the network does not inherently favor ob- ject or background labels while computing weighted sums during training. Values of I are normalized between 0 and 1 accordingly. in order to examine segmentation quality w. r. t. additional domain knowledge inserted into the in- put layer. The smaller b, the more information is provided. During training, no update step by the user model is utilized here, since the networks are trained with the same data in each epoch. We will refer to a network with property S t=i = S t=i+1 as static dur- ing training. (2) To infer, whether additional input data provided by the rule-based user model improves the segmentation quality, seeds are generated with an alternative system to (1). A varying number |G| · n of seeds (S t=0 n ) are sampled uniformly at random  as initial seeds and the user model proposed in Sec. 2.2.UI-nets were trained and evaluated with different seeding ap- proaches. As depicted in Fig. 5 (a, b), the number of given seed points correlates with the overall segmentation quality (experi- ments (1, 2)). For an evaluation with the actual user model, the interactive user input version of the UI-net performs best as de- picted in Fig. 5 (c) (experiment (3)). The UI-net trained with an interacting user model consistently performs better with each ad- ditional input provided by the user, continuously improving its seg- mentation results. Training an FCN with a user model which reacts on deficiencies in current segmentation results during training can therefore improve the overall segmentation result. As visualized in Fig. 5 (c,d), UI-net yields superior segmentation results w. r. t. the interactive and non-learning based GrowCut approach. We found a 6 % average improvement in Dice score given the same images and active user model. user model simulates plausible interactions of a user during the learning phase of the network. In contrast to traditional FCNs, during each classification, new user input ground truth is gener- ated by an operator and included into the input of the network. The UI-net can be subsequently trained with this information. The UI-net learns to incorporate the user information into the process of classification. The proposed UI-net architecture can be superior to fully automated approaches in terms of highly accurate segmenta- tion results, especially in medical applications where only few data sets need to be processed and only a small database of fully an- notated images is available for training. The interactive user input version would need more training epochs than a network with static user input for equivalent results, if the test setup is non-interactive as in Fig. 5 (a).The described technique to include user information into an FCN segmentation system can also be implemented via transfer learn- ing from pre-trained non-interactive FCNs. Here, a second FCN is trained to fine-tune the existing model with user data as an addi- tional input besides the output of the first net. The first FCN then acts as a feature extractor [YCBL14] and can be trained separately from the second net for user interaction. The proposed user model is a rule-based system to simulate a user's behavior. Another set of rules [NRKR10, ZND * 11] and learning-based systems are toWe described a method to incorporate user scribbles as additional input for a semi-automatic neural network image segmentation. A be evaluated for different active user models to further improve the segmentation process by reducing the amount of interactions needed from the user to achieve the same segmentation results by even more adapted user models utilized during training.  Disclaimer: The concept and software presented in this paper are based on research and are not commercially available. Due to regulatory reasons its future availability cannot be guaranteed.
